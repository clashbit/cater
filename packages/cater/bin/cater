#!/usr/bin/env node

// Copyright Jon Williams 2017. See LICENSE file.
const path = require("path");
const Cater = require(path.join(__dirname, "..", "index.js"));

// Available commands
COMMANDS = ["build", "dev", "start"];
PRODUCTION_COMMANDS = ["build", "start"];

// The command line format is `cater [command] <options>` this grabs the
// command.
const command = (process.argv[2] || "--help").toLowerCase().trim();

if (PRODUCTION_COMMANDS.includes(command)) {
  process.env.NODE_ENV = "production";
}

const catchFatal = function(err) {
  console.error(err);
  process.exit(-1);
};

if (COMMANDS.includes(command)) {
  const commandFunctionName = 'run' + command.charAt(0).toUpperCase() + command.slice(1);
  const app = new Cater();
  Cater.readyCommandLine();
  app[commandFunctionName]().catch(catchFatal);
} else {
  console.log(
    `Cater Framework.

    Usage:
        cater build
        cater dev
        cater --help

    Options:
        --help      Show this screen.
`
  );
}
