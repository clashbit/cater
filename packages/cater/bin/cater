#!/usr/bin/env node

// Copyright Jon Williams 2017. See LICENSE file.
const path = require("path");
const Cater = require(path.join(__dirname, "..", "index.js"));
const Runtime = require('cater-runtime');

// Available commands
BUILD_COMMANDS = ["build", "dev"];
RUNTIME_COMMANDS = ["start"];
PRODUCTION_COMMANDS = ["build", "start"];

// The command line format is `cater [command] <options>` this grabs the
// command.
const command = (process.argv[2] || "--help").toLowerCase().trim();

if (PRODUCTION_COMMANDS.includes(command)) {
  process.env.NODE_ENV = "production";
}

const catchFatal = function(err) {
  console.error(err);
  process.exit(-1);
};

const commandFunctionName = "run" + command.charAt(0).toUpperCase() + command.slice(1);

if (BUILD_COMMANDS.includes(command)) {
  const app = new Cater();
  Cater.readyCommandLine();
  app[commandFunctionName]().catch(catchFatal);
} else if (RUNTIME_COMMANDS.includes(command)) {
  const app = new Runtime();
  Runtime.readyCommandLine();
  app[commandFunctionName]().catch(catchFatal);
} else {
  console.log(
    `Cater Framework.

    Usage:
        cater build
        cater dev
        cater --help

    Options:
        --help      Show this screen.
`
  );
}
